"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.proxyPage = void 0;
const previewUtils_js_1 = require("./previewUtils.js");
const preview_js_1 = require("./api/preview.js");
const proxyPage = async (res, urlToProxy, sessionInfo) => {
    try {
        const previewResponse = await (0, preview_js_1.fetchPreviewRender)(urlToProxy, sessionInfo);
        const embeddedHtml = (0, previewUtils_js_1.addRefreshScript)(previewResponse);
        res.status(200).set({ 'Content-Type': 'text/html' }).end(embeddedHtml);
    }
    catch (error) {
        const { accountId } = sessionInfo;
        res
            .status(error.response ? error.response.status : 500)
            .end(`Failed proxy render of page ${urlToProxy} hub id = ${accountId}\n\nError: ${JSON.stringify(error, null, 2)}`);
        return;
    }
};
exports.proxyPage = proxyPage;
